---
title: "Soil Respiration Database Report"
author: "Adam Levin"
date: "7/11/2021"
output: html_document
---

Libraries used and source of data read in:
```{r, message=FALSE, warning=FALSE}
#Libraries
library(tidyr)
library(dplyr)
library(ggplot2)

#Data source
srdbData = read.csv("srdb-master/srdb-data.csv")

```


**Number of Entries by Ecosystem Type:**
```{r, echo = FALSE}
#choose relevant categories
srdbManagable = srdbData %>% select(Latitude, Longitude, Study_midyear, Ecosystem_type, Manipulation, Rs_annual, RC_annual)
 
#number of observations (rows) by ecosystem type
#get rid of whitespace first
srdbManagable$Ecosystem_type = srdbManagable$Ecosystem_type %>% trimws(c("both"))

#group by ecosystem and remove empty entries
groupedByEcoType = srdbManagable %>%  filter(srdbManagable$Ecosystem_type != "") %>% group_by(Ecosystem_type)

ecosystemList = groupedByEcoType %>% select(Ecosystem_type)

print(ecosystemList %>% summarize(n()))

```

**Annual RC Visualization:**
```{r, warning=FALSE, echo=FALSE}
#graph annual RC against lattitude with color coding by ecosystem and size by annual RS
ggplot(groupedByEcoType, aes(RC_annual, Latitude)) + geom_point(aes(color = Ecosystem_type, size = Rs_annual)) + xlim(-.1, 1) + ylim(-50, 70) + theme_classic()

```

**WorldClim Database Addition**
```{r, echo = FALSE, message=FALSE, warning=FALSE}
library(Rcpp)
library(sp)
library(raster)

#get data
precip <- getData("worldclim", var = "prec", res = 10, download = !file.exists("wc10/wc10/precip1.hdr"))
tmean <- getData("worldclim", var = "tmean", res = 10, download = !file.exists("wc10/wc10/tmean1.hdr"))

#select coordinates from srdb
srdbCoords = srdbData %>% dplyr::select(Latitude, Longitude)

#precip mean
precipGlobal = as.data.frame(precip, xy = TRUE) %>% drop_na() 
mapGlobal = precipGlobal %>% dplyr::select(-x, -y) %>% apply(1, mean)

#temp mean
tmeanGlobal = as.data.frame(tmean, xy = TRUE) %>% drop_na()
matGlobal = tmeanGlobal %>% dplyr::select(-x, -y) %>% apply(1, mean)

#tibble creation with coordinates
mat = tibble(x = tmeanGlobal$x, y = tmeanGlobal$y, mat = as.vector(matGlobal))
map = tibble(x = precipGlobal$x, y = precipGlobal$y, map = as.vector(mapGlobal))

#join precip and temp
mapMatGlobal = left_join(map, mat, by = c("x", "y")) %>% mutate(mat = mat/10)
#to get to degC, current format must be divided by 10
mapMatGlobal = mapMatGlobal %>% mutate(mat = mat/10)
  #Rename column names to make joining easier
mapMatGlobal = mapMatGlobal %>% rename("Latitude" = "x", "Longitude" = "y")

#join with srdb study coordinates
srdbMapMat = inner_join(srdbCoords, mapMatGlobal, by = c("Latitude", "Longitude"))

#print coordinates w/ climate
print(srdbMapMat)
``` 
  
**Session Information**
```{r, echo = FALSE}
sessionInfo()
```
